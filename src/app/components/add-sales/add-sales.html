<form
  class="flex flex-col gap-4 max-w-[90vw] p-3"
  [formGroup]="form"
  (ngSubmit)="onSubmit()"
>
  <!-- Header -->
  <div class="flex items-center justify-between">
    <h2 mat-dialog-title class="text-xl heading !text-primary font-semibold">
      Create Royalties
    </h2>
  </div>

  <mat-dialog-content>
    <div class="flex flex-col gap-5 mt-4">
      @for (saleGroup of form.controls.salesArray.controls; track $index) {
      <div
        class="relative border border-[var(--primary-light)] rounded-xl p-5 bg-gradient-to-br from-[var(--light-purple-bg)] to-[var(--primary-superlight)] hover:shadow-lg hover:scale-[1.01] transition-all"
      >
        <!-- Optional delete button -->

        <div class="grid md:grid-cols-3 xl:grid-cols-6 gap-4 items-center">
          <!-- Sale Type -->
          <div>
            <label
              class="block text-xs text-[var(--text-heading)] mb-1 font-medium"
              >Sale Type</label
            >
            <select
              [formControl]="saleGroup.controls.type"
              class="w-full border border-[var(--primary-light)] rounded-md px-3 py-2 text-xs text-[var(--text-primary)] bg-white focus:border-[var(--primary)] outline-none"
            >
              @for (st of salesType(); track $index) {
              <option [value]="st">{{ st | translate }}</option>
              }
            </select>
          </div>

          <!-- Title -->
          <div>
            <label
              class="block text-xs text-[var(--text-heading)] mb-1 font-medium"
              >Title</label
            >
            <select
              [formControl]="saleGroup.controls.title.controls.id"
              class="w-full border border-[var(--primary-light)] rounded-md px-3 py-2 text-xs text-[var(--text-primary)] bg-white focus:border-[var(--primary)] outline-none"
            >
              @for (title of titles() |
              myTitleFilterBySale:saleGroup.controls.title.controls.availableOptions.value;
              track $index) {
              <option [value]="title.id">{{ title.name }}</option>
              }
            </select>
          </div>

          <!-- Platform -->
          <div>
            <label
              class="block text-xs text-[var(--text-heading)] mb-1 font-medium"
              >Platform</label
            >
            <select
              [formControl]="saleGroup.controls.platform"
              class="w-full border border-[var(--primary-light)] rounded-md px-3 py-2 text-xs text-[var(--text-primary)] bg-white focus:border-[var(--primary)] outline-none"
            >
              @for (platform of platforms(); track $index) {
              <option [value]="platform">{{ platform | translate }}</option>
              }
            </select>
          </div>

          <!-- Amount -->
          <div>
            <label
              class="block text-xs text-[var(--text-heading)] mb-1 font-medium"
              >Amount</label
            >
            <input
              type="number"
              [formControl]="saleGroup.controls.amount"
              class="w-full border border-[var(--primary-light)] rounded-md px-3 py-2 text-xs text-[var(--text-primary)] bg-white focus:border-[var(--primary)] outline-none"
            />
          </div>

          <!-- Quantity -->
          <div>
            <label
              class="block text-xs text-[var(--text-heading)] mb-1 font-medium"
              >Quantity</label
            >
            <input
              type="number"
              [formControl]="saleGroup.controls.quantity"
              class="w-full border border-[var(--primary-light)] rounded-md px-3 py-2 text-xs text-[var(--text-primary)] bg-white focus:border-[var(--primary)] outline-none"
            />
          </div>

          <!-- Sold At -->
          <div>
            <label
              class="block text-xs text-[var(--text-heading)] mb-1 font-medium"
              >Sold At</label
            >
            <div class="relative">
              <input
                type="text"
                matInput
                readonly
                (focus)="picker.open()"
                (click)="picker.open()"
                [value]="
                  saleGroup.controls.soldAt.value | myDate : 'dd-MM-yyyy'
                "
                class="w-full border border-[var(--primary-light)] rounded-md px-3 py-2 text-xs text-[var(--text-primary)] bg-white focus:border-[var(--primary)] outline-none"
              />
              <input
                class="opacity-0 absolute top-0 left-0 w-0 h-0"
                matInput
                [ngxMatDatetimePicker]="picker"
                [formControl]="saleGroup.controls.soldAt"
                tabindex="-1"
              />
              <ngx-mat-datetime-picker #picker>
                <ngx-mat-datepicker-actions>
                  <div class="flex justify-between w-full">
                    <button mat-button ngxMatDatepickerCancel>Cancel</button>
                    <button
                      mat-raised-button
                      color="primary"
                      ngxMatDatepickerApply
                    >
                      Apply
                    </button>
                  </div>
                </ngx-mat-datepicker-actions>
              </ngx-mat-datetime-picker>
            </div>
          </div>
        </div>
      </div>
      }
    </div>
  </mat-dialog-content>

  <!-- Action Buttons -->
  <mat-dialog-actions class="mt-4 flex justify-end gap-3">
    <button
      type="button"
      (click)="data.onClose()"
      mat-button
      matButton="filled"
      class="!bg-accent"
    >
      Close
    </button>

    <button
      type="button"
      mat-button
      matButton="filled"
      (click)="addSalesGroup()"
      class="!bg-purple"
    >
      <mat-icon>add</mat-icon>
      Add More
    </button>

    <button type="submit" mat-button matButton="filled" class="!bg-primary">
      Confirm
    </button>
  </mat-dialog-actions>
</form>
