<div class="flex gap-4 items-center">
  <!-- User Icon -->
  <button mat-icon-button class="w-8 h-8">
    <svg-icon class="fill-black" src="images/user-solid-full.svg"></svg-icon>
  </button>

  <!-- Notification Icon with Badge -->
  <button
    mat-icon-button
    [matMenuTriggerFor]="notificationMenu"
    [matBadge]="unreadNotifications().length"
    matBadgeColor="warn"
    matBadgeOverlap="false"
    class="w-8 h-8"
  >
    <svg-icon class="fill-black" src="images/bell-solid-full.svg"></svg-icon>
  </button>
</div>

<!-- Notification Menu -->
<mat-menu
  #notificationMenu="matMenu"
  class="!p-0 w-[320px] max-w-[320px]"
  (closed)="onNotificationClose()"
>
  <!-- Header -->
  <div class="px-3 py-2 border-b border-gray-200 bg-gray-50">
    <span class="font-semibold text-sm text-gray-700">Notifications</span>
  </div>

  <!-- Notifications List (scrollable container inside menu) -->
  <div class="max-h-[300px] overflow-y-auto">
    @if (notifications().length) { @for (notification of notifications(); track
    $index) {
    <div
      class="px-3 py-2 flex flex-col gap-1 border-b border-gray-100 hover:bg-gray-50 transition-colors duration-150"
    >
      <span class="font-medium text-sm text-gray-800">
        {{ notification.title }}
      </span>

      <p class="text-xs text-gray-600 leading-snug">
        {{ notification.message }}
      </p>

      <div class="flex justify-between items-center text-[11px] text-gray-400">
        <span>&nbsp;</span>
        @if (notification.sendAt) {
        <span>Sent: {{ notification.sendAt | date : "medium" }}</span>
        }
      </div>
    </div>
    } } @else {
    <div class="px-4 py-3 text-sm text-gray-500 text-center">
      No new notifications
    </div>
    }
  </div>

  <!-- Manage Button (SuperAdmin only) -->
  <div class="grid grid-cols-2 gap-4 border-t border-gray-200 p-2 text-center">
    @if (lastPage() > page()) {

    <!-- fetch-notifications -->
    <button
      (click)="loadMoreNotifications($event)"
      mat-stroked-button
      class="w-full !text-primary"
      [disabled]="isNotificationLoading$ | async"
    >
      {{
        ((isNotificationLoading$ | async) ? "loading" : "loadmore") | translate
      }}
      @if((isNotificationLoading$ | async)) {
      <span class="loading-dots"></span>
      }
    </button>
    } @else {
    <span>&nbsp;</span>
    } @if (loggedInUser()?.accessLevel === 'SUPERADMIN') {

    <button
      mat-stroked-button
      class="w-full !text-primary"
      routerLink="/notifications"
    >
      {{ "manage" | translate }}
    </button>
    }
  </div>
</mat-menu>
