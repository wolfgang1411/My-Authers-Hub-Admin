<div class="flex flex-col flex-grow gap-4">
  <div class="flex justify-between">
    <h3 class="heading">{{ "invites" | translate }}</h3>
  </div>

  <!-- Filter Buttons -->
  @if (showFilterButtons()) {
  <div class="flex gap-2 flex-wrap">
    <button
      class="btn rounded-md bg-primary-superlight !text-primary"
      type="button"
      matButton="filled"
      matButton
      [ngClass]="{
        '!bg-primary !text-white': selectedInviteType() === 'ALL',
        '!bg-primary-superlight': selectedInviteType() !== 'ALL'
      }"
      (click)="onInviteTypeChange('ALL')"
    >
      {{ "all" | translate }}
    </button>
    @for (type of availableInviteTypes(); track type) {
    <button
      class="btn rounded-md bg-primary-superlight !text-primary"
      type="button"
      matButton="filled"
      matButton
      [ngClass]="{
        '!bg-primary !text-white': selectedInviteType() === type,
        '!bg-primary-superlight': selectedInviteType() !== type
      }"
      (click)="onInviteTypeChange(type)"
    >
      {{ type | translate }}
    </button>
    }
  </div>
  }

  @if (isLoading()) {
  <div class="flex justify-center items-center py-8">
    <span>{{ "loading" | translate }}...</span>
  </div>
  } @else if (errorMessage()) {
  <div class="flex justify-center items-center py-8 text-red-600">
    <span>{{ errorMessage() }}</span>
  </div>
  } @else {
  <app-list-table
    class="pt-6"
    [dataSource]="dataSource"
    [displayedColumns]="displayedColumns()"
    [actionTemplate]="actionButtons"
  >
  </app-list-table>

  <div class="flex items-center justify-between gap-4 mt-4">
    <div class="flex items-center gap-2">
      <span class="text-sm text-[var(--text-secondary)]">
        {{ "page" | translate }} {{ filter().page || 1 }}
        {{ "of" | translate }} {{ lastPage() }}
      </span>
      <span class="text-sm text-[var(--text-secondary)]">|</span>
      <span class="text-sm text-[var(--text-secondary)]"
        >{{ "itemsperpage" | translate }}:</span
      >
      <select
        class="px-2 py-1 border border-[var(--primary-superlight)] rounded-md text-sm"
        [value]="filter().itemsPerPage || 30"
        (change)="onItemsPerPageChange(+$any($event.target).value)"
      >
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
    </div>
    @if (lastPage() > 1) {
    <div class="flex items-center gap-2">
      <button
        class="btn rounded-md !text-primary"
        matButton="filled"
        matButton
        type="button"
        [disabled]="(filter().page || 1) === 1"
        (click)="previousPage()"
      >
        <mat-icon>chevron_left</mat-icon>
        {{ "previous" | translate }}
      </button>
      <div class="flex items-center gap-1">
        @for (pageNum of getPageNumbers(); track pageNum) { @if (pageNum === -1)
        {
        <span class="px-2 text-[var(--text-secondary)]">...</span>
        } @else {
        <button
          class="btn rounded-md !text-primary min-w-[40px]"
          matButton="filled"
          matButton
          type="button"
          [ngClass]="{
            '!bg-primary !text-white': (filter().page || 1) === pageNum,
            '!bg-primary-superlight': (filter().page || 1) !== pageNum
          }"
          (click)="goToPage(pageNum)"
        >
          {{ pageNum }}
        </button>
        } }
      </div>
      <button
        class="btn rounded-md !text-primary"
        matButton="filled"
        matButton
        type="button"
        [disabled]="(filter().page || 1) === lastPage()"
        (click)="nextPage()"
      >
        {{ "next" | translate }}
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
    }
  </div>
  }

  <ng-template #actionButtons let-element>
    <div class="flex gap-2 text-blue-600 text-sm items-center">
      @if (canAcceptOrRejectInvite(element)) {
      <button
        class="!bg-green-2 active:bg-green-2/60"
        mat-icon-button
        (click)="onAcceptInvite(element)"
        [title]="'accept' | translate"
      >
        <mat-icon class="!text-white">check</mat-icon>
      </button>
      <button
        class="!bg-red-colour active:bg-red-colour/60"
        mat-icon-button
        (click)="onRejectInvite(element)"
        [title]="'reject' | translate"
      >
        <mat-icon class="!text-white">close</mat-icon>
      </button>
      }
      @if (canRevokeInvite(element)) {
      <button
        class="!bg-red-colour active:bg-red-colour/60"
        mat-icon-button
        (click)="onRevokeInvite(element)"
        [title]="'revoke' | translate"
      >
        <mat-icon class="!text-white">cancel</mat-icon>
      </button>
      }
    </div>
  </ng-template>
</div>

