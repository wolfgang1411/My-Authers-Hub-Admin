<div class="flex flex-col flex-grow gap-4">
  <h3 class="heading">
    {{ "updatetickets" | translate }}
  </h3>

  <div class="flex md:flex-row flex-col justify-between w-full gap-4">
    <div
      class="flex h-[38px] items-center justify-center md:min-w-[480px] min-w-full gap-2"
    >
      <input
        class="input-field outline-none w-full"
        #input
        (input)="searchStr.next(input.value)"
        [placeholder]="'search' | translate"
      />
      <button
        class="btn h-[38px] flex items-center self-end justify-center gap-2"
        (click)="searchStr.next(input.value)"
      >
        <svg-icon
          src="images/magnifying-glass-solid-full.svg"
          class="w-4 fill-white flex"
        ></svg-icon>
        {{ "search" | translate }}
      </button>
    </div>
  </div>

  <mat-tab-group
    [selectedIndex]="selectedTabIndex()"
    (selectedIndexChange)="onTabChange($event)"
    (selectedIndexChange)="onTabChange($event)"
    class="w-full"
  >
    <!-- Title Details Tab -->
    <mat-tab label="{{ 'details' | translate }}">
      <div class="pt-6">
        <app-list-table
          [dataSource]="titleUpdateDataSource"
          [displayedColumns]="titleUpdateColumns"
          [actionTemplate]="titleUpdateActions"
        >
        </app-list-table>
        @if(hasMoreTickets(0)) {
        <div class="flex justify-center mt-4">
          <button
            class="btn !bg-primary text-white"
            (click)="loadMoreTickets()"
            [disabled]="isLoading()"
          >
            {{ "loadmore" | translate }}
          </button>
        </div>
        }
        <ng-template #titleUpdateActions let-element>
          <div
            class="flex gap-2 text-blue-600 text-sm items-center lg:flex-wrap"
          >
            <button
              class="!bg-primary"
              mat-icon-button
              (click)="onViewTicket(element)"
              [title]="'view' | translate"
            >
              <mat-icon class="!text-white">visibility</mat-icon>
            </button>
            @if(isSuperAdmin() && element.status === 'PENDING') {
            <button
              (click)="onApproveTitleUpdateTicket(element.ticket)"
              [title]="'approve' | translate"
              class="!bg-green-700"
              mat-icon-button
            >
              <mat-icon class="!text-white">thumb_up</mat-icon>
            </button>
            <button
              (click)="onRejectTitleUpdateTicket(element.ticket)"
              [title]="'reject' | translate"
              class="!bg-accent"
              mat-icon-button
            >
              <mat-icon class="!text-white">thumb_down</mat-icon>
            </button>
            }
          </div>
        </ng-template>
      </div>
    </mat-tab>

    <!-- Printing Tab -->
    <mat-tab label="{{ 'print' | translate }}">
      <div class="pt-6">
        <app-list-table
          [dataSource]="printingUpdateDataSource"
          [displayedColumns]="printingUpdateColumns"
          [actionTemplate]="printingUpdateActions"
        >
        </app-list-table>
        @if(hasMoreTickets(1)) {
        <div class="flex justify-center mt-4">
          <button
            class="btn !bg-primary text-white"
            (click)="loadMoreTickets()"
            [disabled]="isLoading()"
          >
            {{ "loadmore" | translate }}
          </button>
        </div>
        }
        <ng-template #printingUpdateActions let-element>
          <div
            class="flex gap-2 text-blue-600 text-sm items-center lg:flex-wrap"
          >
            <button
              class="!bg-primary"
              mat-icon-button
              (click)="onViewTicket(element)"
              [title]="'view' | translate"
            >
              <mat-icon class="!text-white">visibility</mat-icon>
            </button>
            @if(isSuperAdmin() && element.status === 'PENDING') {
            <button
              (click)="onApprovePrintingUpdateTicket(element.ticket)"
              [title]="'approve' | translate"
              class="!bg-green-700"
              mat-icon-button
            >
              <mat-icon class="!text-white">thumb_up</mat-icon>
            </button>
            <button
              (click)="onRejectPrintingUpdateTicket(element.ticket)"
              [title]="'reject' | translate"
              class="!bg-accent"
              mat-icon-button
            >
              <mat-icon class="!text-white">thumb_down</mat-icon>
            </button>
            }
          </div>
        </ng-template>
      </div>
    </mat-tab>

    <!-- Pricing Tab -->
    <mat-tab label="{{ 'pricing' | translate }}">
      <div class="pt-6">
        <app-list-table
          [dataSource]="pricingUpdateDataSource"
          [displayedColumns]="pricingUpdateColumns"
          [actionTemplate]="pricingUpdateActions"
        >
        </app-list-table>
        @if(hasMoreTickets(2)) {
        <div class="flex justify-center mt-4">
          <button
            class="btn !bg-primary text-white"
            (click)="loadMoreTickets()"
            [disabled]="isLoading()"
          >
            {{ "loadmore" | translate }}
          </button>
        </div>
        }
        <ng-template #pricingUpdateActions let-element>
          <div
            class="flex gap-2 text-blue-600 text-sm items-center lg:flex-wrap"
          >
            <button
              class="!bg-primary"
              mat-icon-button
              (click)="onViewTicket(element)"
              [title]="'view' | translate"
            >
              <mat-icon class="!text-white">visibility</mat-icon>
            </button>
            @if(isSuperAdmin() && element.status === 'PENDING') {
            <button
              (click)="onApprovePricingUpdateTicket(element.ticket)"
              [title]="'approve' | translate"
              class="!bg-green-700"
              mat-icon-button
            >
              <mat-icon class="!text-white">thumb_up</mat-icon>
            </button>
            <button
              (click)="onRejectPricingUpdateTicket(element.ticket)"
              [title]="'reject' | translate"
              class="!bg-accent"
              mat-icon-button
            >
              <mat-icon class="!text-white">thumb_down</mat-icon>
            </button>
            }
          </div>
        </ng-template>
      </div>
    </mat-tab>

    <!-- Royalty Tab -->
    <mat-tab label="{{ 'royalty' | translate }}">
      <div class="pt-6">
        <app-list-table
          [dataSource]="royaltyUpdateDataSource"
          [displayedColumns]="royaltyUpdateColumns"
          [actionTemplate]="royaltyUpdateActions"
        >
        </app-list-table>
        @if(hasMoreTickets(3)) {
        <div class="flex justify-center mt-4">
          <button
            class="btn !bg-primary text-white"
            (click)="loadMoreTickets()"
            [disabled]="isLoading()"
          >
            {{ "loadmore" | translate }}
          </button>
        </div>
        }
        <ng-template #royaltyUpdateActions let-element>
          <div
            class="flex gap-2 text-blue-600 text-sm items-center lg:flex-wrap"
          >
            <button
              class="!bg-primary"
              mat-icon-button
              (click)="onViewTicket(element)"
              [title]="'view' | translate"
            >
              <mat-icon class="!text-white">visibility</mat-icon>
            </button>
            @if(isSuperAdmin() && element.status === 'PENDING') {
            <button
              (click)="onApproveRoyaltyUpdateTicket(element.ticket)"
              [title]="'approve' | translate"
              class="!bg-green-700"
              mat-icon-button
            >
              <mat-icon class="!text-white">thumb_up</mat-icon>
            </button>
            <button
              (click)="onRejectRoyaltyUpdateTicket(element.ticket)"
              [title]="'reject' | translate"
              class="!bg-accent"
              mat-icon-button
            >
              <mat-icon class="!text-white">thumb_down</mat-icon>
            </button>
            }
          </div>
        </ng-template>
      </div>
    </mat-tab>

    <!-- Media/Documents Tab -->
    <mat-tab label="{{ 'documents' | translate }}">
      <div class="pt-6">
        <app-list-table
          [dataSource]="mediaUpdateDataSource"
          [displayedColumns]="mediaUpdateColumns"
          [actionTemplate]="mediaUpdateActions"
        >
        </app-list-table>
        @if(hasMoreTickets(4)) {
        <div class="flex justify-center mt-4">
          <button
            class="btn !bg-primary text-white"
            (click)="loadMoreTickets()"
            [disabled]="isLoading()"
          >
            {{ "loadmore" | translate }}
          </button>
        </div>
        }
        <ng-template #mediaUpdateActions let-element>
          <div
            class="flex gap-2 text-blue-600 text-sm items-center lg:flex-wrap"
          >
            <button
              class="!bg-primary"
              mat-icon-button
              (click)="onViewTicket(element)"
              [title]="'view' | translate"
            >
              <mat-icon class="!text-white">visibility</mat-icon>
            </button>
            @if(isSuperAdmin() && element.status === 'PENDING') {
            <button
              (click)="onApproveMediaUpdateTicket(element.ticket)"
              [title]="'approve' | translate"
              class="!bg-green-700"
              mat-icon-button
            >
              <mat-icon class="!text-white">thumb_up</mat-icon>
            </button>
            <button
              (click)="onRejectMediaUpdateTicket(element.ticket)"
              [title]="'reject' | translate"
              class="!bg-accent"
              mat-icon-button
            >
              <mat-icon class="!text-white">thumb_down</mat-icon>
            </button>
            }
          </div>
        </ng-template>
      </div>
    </mat-tab>

    <!-- Distribution Tab -->
    <mat-tab label="{{ 'distribution' | translate }}">
      <div class="pt-6">
        <app-list-table
          [dataSource]="distributionUpdateDataSource"
          [displayedColumns]="distributionUpdateColumns"
          [actionTemplate]="distributionUpdateActions"
        >
        </app-list-table>
        @if(hasMoreTickets(5)) {
        <div class="flex justify-center mt-4">
          <button
            class="btn !bg-primary text-white"
            (click)="loadMoreTickets()"
            [disabled]="isLoading()"
          >
            {{ "loadmore" | translate }}
          </button>
        </div>
        }
        <ng-template #distributionUpdateActions let-element>
          <div
            class="flex gap-2 text-blue-600 text-sm items-center lg:flex-wrap"
          >
            <button
              class="!bg-primary"
              mat-icon-button
              (click)="onViewTicket(element)"
              [title]="'view' | translate"
            >
              <mat-icon class="!text-white">visibility</mat-icon>
            </button>
            @if(isSuperAdmin() && element.status === 'PENDING') {
            <button
              (click)="onApproveDistributionUpdateTicket(element.ticket)"
              [title]="'approve' | translate"
              class="!bg-green-700"
              mat-icon-button
            >
              <mat-icon class="!text-white">thumb_up</mat-icon>
            </button>
            <button
              (click)="onRejectDistributionUpdateTicket(element.ticket)"
              [title]="'reject' | translate"
              class="!bg-accent"
              mat-icon-button
            >
              <mat-icon class="!text-white">thumb_down</mat-icon>
            </button>
            }
          </div>
        </ng-template>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
