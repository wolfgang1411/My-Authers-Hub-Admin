<div class="flex flex-col flex-grow gap-4">
  <nav class="flex flex-col gap-6 sticky z-10 py-4">
    <div class="flex justify-between items-center">
      <h3 class="heading">{{ "publisherdetails" | translate }}</h3>
      <app-back></app-back>
    </div>
  </nav>
  <mat-tab-group dynamicHeight>
    <mat-tab>
      <ng-template mat-tab-label>
        <span class="text-text-heading font-medium">
          {{ "publisherdetails" | translate }}
        </span>
      </ng-template>
      <section
        id="publisher-details"
        class="mt-10 bg-white p-6 rounded-xl shadow mat-elevation-z4"
      >
        <h2 class="heading mb-4">{{ "publisherdetails" | translate }}</h2>
        <ul class="space-y-2 grid grid-cols-3 gap-4">
          <li class="text-text">
            <label class="font-medium">{{ "companyname" | translate }} :</label>
            {{ publisherDetails()?.name }}
          </li>
          <li class="text-text">
            <label class="font-medium" class="font-medium"
              >{{ "emailidofficial" | translate }} :</label
            >
            {{ publisherDetails()?.email || "xyzpublication@gmail.com" }}
          </li>
          <li class="text-text">
            <label class="font-medium"
              >{{ "publishername" | translate }} :</label
            >
            {{
              publisherDetails()?.user?.firstName +
                " " +
                publisherDetails()?.user?.lastName
            }}
          </li>
          <li class="text-text">
            <label class="font-medium"
              >{{ "publishercontactnumber" | translate }} :</label
            >{{ publisherDetails()?.user?.phoneNumber }} ,
            {{ publisherDetails()?.phoneNumber }}
          </li>
          <li class="text-text">
            <label class="font-medium"
              >{{ "publisheremailid" | translate }} :</label
            >
            {{ publisherDetails()?.user?.email }}
          </li>
          <li class="text-text">
            <label class="font-medium"
              >{{ "publisherdesignation" | translate }} :</label
            >
            {{ publisherDetails()?.designation }}
          </li>
          <li class="text-text">
            <label class="font-medium">{{ "address" | translate }} :</label>
            {{ completeAddress() }}
          </li>
        </ul>
        <h2 class="heading my-4 !mt-6">{{ "bankdetails" | translate }}</h2>
        <ul class="space-y-2 grid grid-cols-3 gap-4">
          <li class="text-text">
            <label class="font-medium">{{ "bankname" | translate }} :</label>
            {{ publisherDetails()?.bankDetails?.[0]?.name || "Not Provided"   }}
          </li>
          <li class="text-text">
            <label class="font-medium"
              >{{ "accountnumber" | translate }} :</label
            >
            {{ publisherDetails()?.bankDetails?.[0]?.accountNo }}
          </li>
          <li class="text-text">
            <label class="font-medium">{{ "ifsccode" | translate }} :</label>
            {{ publisherDetails()?.bankDetails?.[0]?.ifsc }}
          </li>
          <li class="text-text">
            <label class="font-medium">{{ "accounttype" | translate }} :</label>
            {{ publisherDetails()?.bankDetails?.[0]?.accountType }}
          </li>
          <li class="text-text">
            <label class="font-medium"
              >{{ "pancardnumber" | translate }} :</label
            >
            {{ publisherDetails()?.bankDetails?.[0]?.panCardNo }}
          </li>
        </ul>
      </section>
    </mat-tab>
    <!-- Books Published -->
    <mat-tab>
      <ng-template mat-tab-label>
        <span class="text-text-heading font-medium">
          {{ "bookspublished" | translate }}
        </span>
      </ng-template>
      <section
        id="books-published"
        class="mt-10 bg-white p-6 rounded-xl shadow"
      >
        <div class="flex justify-between">
          <h2 class="heading mb-4">{{ "bookspublished" | translate }}</h2>
          <mat-form-field>
            <mat-label>{{ "filter" | translate }}</mat-label>
            <input
              matInput
              (keyup)="applyFilter($event)"
              placeholder="Ex. ium"
              #input
            />
          </mat-form-field>
        </div>
        <app-list-table
          class="pt-6"
          [dataSource]="bookPublishData"
          [displayedColumns]="displayedColumns"
        >
        </app-list-table>
      </section>
    </mat-tab>
    <!-- Authors -->
    <mat-tab>
      <ng-template mat-tab-label>
        <span class="text-text-heading font-medium">
          {{ "authors" | translate }}
        </span>
      </ng-template>
      <section id="authors" class="mt-10 bg-white p-6 rounded-xl shadow">
        <div class="flex justify-between">
          <h2 class="heading mb-4">{{ "authors" | translate }}</h2>
          <mat-form-field>
            <mat-label>{{ "filter" | translate }}</mat-label>
            <input
              matInput
              (input)="applyAuthorFilter($event)"
              placeholder="Ex. ium"
              #input
            />
          </mat-form-field>
        </div>
        <app-list-table
          class="pt-6"
          [dataSource]="authorData"
          [displayedColumns]="displayedAuthorColumns"
        >
        </app-list-table>
      </section>
    </mat-tab>
    <!-- Sub-Publishers -->
    <mat-tab>
      <ng-template mat-tab-label>
        <span class="text-text-heading font-medium">
          {{ "subpublishers" | translate }}
        </span>
      </ng-template>
      <section id="sub-publishers" class="mt-10 bg-white p-6 rounded-xl shadow">
        <div class="flex justify-between">
          <h2 class="heading mb-4">{{ "subpublishers" | translate }}</h2>
          <mat-form-field>
            <mat-label>{{ "filter" | translate }}</mat-label>
            <input
              matInput
              (keyup)="applySubPublisherFilter($event)"
              placeholder="Ex. ium"
              #input
            />
          </mat-form-field>
        </div>
        <app-list-table
          class="pt-6"
          [dataSource]="subPublisherData"
          [displayedColumns]="displayedSubPublisherColumns"
        >
        </app-list-table>
      </section>
    </mat-tab>

    <!-- Royalties -->
    <mat-tab>
      <ng-template mat-tab-label>
        <span class="text-text-heading font-medium">
          {{ "royalties&wallet" | translate }}
        </span>
      </ng-template>
      <section
        id="royalties"
        class="mt-10 bg-white p-6 rounded-xl shadow flex flex-col gap-6"
      >
        <h2 class="heading">{{ "Royalties&Wallet" | translate }}</h2>
        <ul class="space-y-2">
          <li>
            ğŸª™ {{ "walletbalance" | translate }} :
            <label class="font-medium">{{
              (publisherDetails()?.user?.wallet?.totalAmount || 0) -
                (publisherDetails()?.user?.wallet?.holdAmount || 0)
                | currency : "INR"
            }}</label>
          </li>
          <li>
            â³{{ "onhold" | translate }} :
            <label class="font-medium">{{
              publisherDetails()?.user?.wallet?.holdAmount || 0
                | currency : "INR"
            }}</label>
          </li>
        </ul>

        <app-list-table
          [dataSource]="royaltyData"
          [displayedColumns]="displayedRoyaltyColumns()"
        >
        </app-list-table>
      </section>
    </mat-tab>
    <mat-tab>
      <ng-template mat-tab-label>
        <span class="text-text-heading font-medium">
          {{ "publishingpoints" | translate }}
        </span>
      </ng-template>

      <section
        id="publishing-points"
        class="mt-10 bg-white p-6 rounded-xl shadow"
      >
        @if (publishingpoints().length) {
        <div class="grid md:grid-cols-2 xl:grid-cols-3 gap-4 mt-4">
          @for (point of publishingpoints(); track $index) {
          <div
            class="group border border-[var(--primary-superlight)] rounded-xl p-4 bg-gradient-to-br from-white to-[var(--light-purple-bg)] hover:shadow-lg hover:scale-[1.02] transition-all"
          >
            <!-- Header Row -->
            <div class="flex items-center justify-between mb-3">
              <div class="flex items-center gap-2">
                <div
                  class="p-2 rounded-full bg-[var(--light-purple-bg)] text-[var(--primary)]"
                >
                  <mat-icon>redeem</mat-icon>
                </div>
                <h5
                  class="font-medium text-[var(--text-heading)] text-base capitalize"
                >
                  {{ point.distributionType.replace("_", " ") }}
                </h5>
              </div>
              <span
                class="text-[var(--green-2)] text-xs font-medium bg-[var(--light-green-bg)] px-3 py-1 rounded-full border border-[var(--light-green-2)]"
              >
                {{ point.availablePoints }} Points
              </span>
            </div>

            <!-- Details -->
            <div class="text-sm text-[var(--text-primary)]">
              <p class="flex items-center">
                <span class="font-medium text-[var(--text-heading)]">ID:</span>
                <span
                  class="ml-2 px-2 py-[2px] rounded bg-[var(--primary-superlight)] text-[var(--primary)] font-medium text-xs"
                  >{{ point.id }}</span
                >
              </p>
              <p class="mt-2">
                <span class="font-medium text-[var(--text-heading)]"
                  >Created:</span
                >
                <span class="ml-2 text-xs text-gray-600">{{
                  point.createdAt | date : "mediumDate"
                }}</span>
              </p>
            </div>

            <!-- Buy Button -->
            <div class="mt-4 flex justify-end">
              <button
                mat-raised-button
                color="primary"
                class="!text-xs !py-1.5 !px-4"
                (click)="buyPoints(point.distributionType)"
              >
                Buy More
              </button>
            </div>
          </div>
          }
        </div>
        } @else {
        <div
          class="flex flex-col justify-center p-8 bg-[var(--light-purple-bg)] rounded-2xl border border-[var(--primary-light)]"
        >
          <!-- Show all 5 Distribution Channels -->
          <div class="grid md:grid-cols-2 xl:grid-cols-3 gap-4 mt-6">
            @for (type of distributionType(); track type) {
            <div
              class="group border border-[var(--primary-superlight)] rounded-xl p-4 bg-gradient-to-br from-white to-[var(--light-purple-bg)] hover:shadow-lg hover:scale-[1.02] transition-all"
            >
              <div class="flex items-center gap-2 mb-3">
                <div
                  class="p-2 rounded-full bg-[var(--light-purple-bg)] text-[var(--primary)]"
                >
                  <mat-icon>storefront</mat-icon>
                </div>
                <h5
                  class="font-medium text-[var(--text-heading)] text-base capitalize"
                >
                  {{ type.replace("_", " ") }}
                </h5>
              </div>

              <div class="text-sm text-[var(--text-primary)]">
                <p>No points purchased yet for this channel.</p>
              </div>

              <div class="mt-4 flex justify-end">
                <button
                  mat-raised-button
                  color="accent"
                  class="!text-xs !py-1.5 !px-4 !bg-green-2 !text-white focus:bg-green-2/50"
                  (click)="buyPoints(type)"
                >
                  Buy Points
                </button>
              </div>
            </div>
            }
          </div>
        </div>
        }
      </section>
    </mat-tab>

    <!-- Published Links -->
    <mat-tab>
      <ng-template mat-tab-label>
        <span class="text-text-heading font-medium">
          {{ "publishedlinks" | translate }}
        </span>
      </ng-template>
      <section
        id="published-links"
        class="mt-10 bg-white p-6 rounded-xl shadow"
      >
        <h2 class="heading mb-4">Published Links</h2>
        <ul class="list-disc pl-6">
          @for (distribution of distributions(); track $index) {
          <li>
            <a target="_blank" [href]="distribution.link" class="text-blue-600">
              {{ distribution.type | translate }}
            </a>
          </li>
          }
        </ul>
      </section>
    </mat-tab>
    <!-- Attachments -->
    <!-- <mat-tab>
      <ng-template mat-tab-label>
        <span class="text-text-heading font-medium">
          {{ "attachments" | translate }}
        </span>
      </ng-template>
      <section id="attachments" class="mt-10 bg-white p-6 rounded-xl shadow">
        <h2 class="heading mb-4">Attachments</h2>
        <ul class="list-disc pl-6">
          <li><a href="#" class="text-blue-600">PAN Document</a></li>
          <li><a href="#" class="text-blue-600">Publisher Agreement</a></li>
        </ul>
      </section>
    </mat-tab> -->
  </mat-tab-group>
</div>
