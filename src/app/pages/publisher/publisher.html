<div class="flex flex-col flex-grow gap-6">
  <!-- ================= HEADER ================= -->
  <div
    class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
  >
    <h3 class="heading">
      {{ "publishers" | translate }}
    </h3>

    <div class="flex flex-wrap gap-2">
      @if (
        loggedInUser()?.accessLevel === "SUPERADMIN" ||
        (loggedInUser()?.accessLevel === "PUBLISHER" &&
          loggedInUser()?.publisher?.type === "Publisher")
      ) {
        <button
          mat-flat-button
          color="primary"
          [routerLink]="['/publisher', 0]"
        >
          <mat-icon>add</mat-icon>
          {{ "addpublisher" | translate }}
        </button>

        <button mat-stroked-button color="primary" (click)="invitePublisher()">
          <mat-icon>person_add</mat-icon>
          {{ "invitepublisher" | translate }}
        </button>
      }

      <button mat-stroked-button color="primary" [routerLink]="['/invites']">
        <mat-icon>mail</mat-icon>
        {{ "invites" | translate }}
      </button>
    </div>
  </div>

  <!-- ================= SEARCH + FILTER ================= -->
  <div class="flex flex-col md:flex-row gap-3">
    <!-- Search -->
    <div class="flex gap-2 w-full md:max-w-[520px]">
      <input
        class="input-field w-full"
        #input
        [placeholder]="'search' | translate"
        (input)="searchStr.next(input.value)"
      />
      <button class="btn" (click)="searchStr.next(input.value)">
        <svg-icon
          src="images/magnifying-glass-solid-full.svg"
          class="w-4 fill-white flex"
        ></svg-icon>
      </button>
    </div>

    <!-- Status Filter -->
    <mat-form-field class="compact-select h-[42px]" appearance="outline">
      <mat-select
        (selectionChange)="onStatusChange($event.value)"
        [value]="filter().status"
      >
        <mat-option value="ALL">ALL</mat-option>
        @for (status of publisherDBStatus(); track $index) {
          <mat-option [value]="status">{{ status | translate }}</mat-option>
        }
      </mat-select>
    </mat-form-field>
  </div>

  <!-- ================= DESKTOP TABLE ================= -->
  <div class="hidden md:block pt-4">
    <app-list-table
      [dataSource]="dataSource"
      [displayedColumns]="displayedColumns()"
      [actionTemplate]="actionButtons"
      [isSortable]="isSortable"
      (sortChange)="onSortChange($event)"
    ></app-list-table>
  </div>

  <!-- ================= MOBILE CARDS ================= -->
  <div class="md:hidden flex flex-col gap-4 pt-2">
    @for (publisher of dataSource.data; track publisher.id) {
      <div class="bg-white rounded-xl border shadow-sm p-4 space-y-4">
        <!-- Header -->
        <div class="flex justify-between items-start">
          <div>
            <h4 class="font-semibold text-gray-800">
              {{ publisher.name }}
            </h4>
            <p class="text-sm text-gray-400">
              {{ publisher.email }}
            </p>
          </div>

          <span
            class="px-2 py-1 text-xs rounded-full bg-primary/10 text-primary"
          >
            {{ publisher.status | translate }}
          </span>
        </div>

        <!-- Info Grid -->
        <div class="grid grid-cols-2 gap-3 text-sm">
          <div>
            <p class="text-gray-400">Titles</p>
            <p class="font-medium">{{ publisher.noOfTitles }}</p>
          </div>
          <div>
            <p class="text-gray-400">Authors</p>
            <p class="font-medium">{{ publisher.noOfAuthors }}</p>
          </div>
          <div>
            <p class="text-gray-400">Phone</p>
            <p class="font-medium">
              {{ publisher.user?.phoneNumber || "-" }}
            </p>
          </div>
          <div>
            <p class="text-gray-400">Type</p>
            <p class="font-medium">
              {{ publisher.type }}
            </p>
          </div>
        </div>

        <!-- Actions -->
        <div class="flex flex-wrap gap-2 pt-2">
          <button
            mat-icon-button
            class="!bg-primary"
            [routerLink]="['/publisherDetails', publisher.id]"
          >
            <mat-icon class="!text-white">visibility</mat-icon>
          </button>

          <button
            mat-icon-button
            class="!bg-primary"
            [routerLink]="['/publisher', publisher.id]"
          >
            <mat-icon class="!text-white">edit</mat-icon>
          </button>
        </div>
      </div>
    }
  </div>

  <!-- ================= PAGINATION ================= -->
  <div
    class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mt-4"
  >
    <!-- Left -->
    <div class="flex flex-wrap items-center gap-2">
      <span class="text-sm text-[var(--text-secondary)]">
        {{ "page" | translate }} {{ filter().page || 1 }} {{ "of" | translate }}
        {{ lastPage() }}
      </span>

      <span class="text-sm text-[var(--text-secondary)] hidden md:inline"
        >|</span
      >

      <span class="text-sm text-[var(--text-secondary)]">
        {{ "itemsperpage" | translate }}:
      </span>

      <select
        class="px-2 py-1 border border-[var(--primary-superlight)] rounded-md text-sm"
        [value]="filter().itemsPerPage || 30"
        (change)="onItemsPerPageChange(+$any($event.target).value)"
      >
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="30">30</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
    </div>

    <!-- Right -->
    @if (lastPage() > 1) {
      <div class="flex gap-2 w-full md:w-auto">
        <button
          class="btn flex-1 md:flex-none"
          matButton="filled"
          [disabled]="(filter().page || 1) === 1"
          (click)="previousPage()"
        >
          <mat-icon>chevron_left</mat-icon>
          {{ "previous" | translate }}
        </button>

        <button
          class="btn flex-1 md:flex-none"
          matButton="filled"
          [disabled]="(filter().page || 1) === lastPage()"
          (click)="nextPage()"
        >
          {{ "next" | translate }}
          <mat-icon>chevron_right</mat-icon>
        </button>
      </div>
    }
  </div>

  <!-- ================= ACTION TEMPLATE ================= -->
  <ng-template #actionButtons let-element>
    <div class="flex gap-2 items-center justify-end flex-wrap">
      <button
        class="!bg-primary"
        mat-icon-button
        [routerLink]="['/publisherDetails', element.id]"
      >
        <mat-icon class="!text-white">visibility</mat-icon>
      </button>

      <button
        class="!bg-primary"
        mat-icon-button
        [routerLink]="['/publisher', element.id]"
      >
        <mat-icon class="!text-white">edit</mat-icon>
      </button>
    </div>
  </ng-template>
</div>
